<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AGASEKE - Digital Piggy Bank</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Better mobile touch handling */
        button, .action-btn, .nav-item, .back-btn, .filter-tab {
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            min-height: 44px;
            min-width: 44px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 20px;
            padding: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            position: relative;
        }

        .screen {
            width: 100%;
            height: 100%;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }

        .light-mode {
            background: #ffffff;
            color: #1a1a1a;
        }

        .dark-mode {
            background: #1a1a1a;
            color: #ffffff;
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }

        .page.active {
            display: block;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .dark-mode .status-bar {
            color: #ffffff;
        }

        .header {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e5e5;
        }

        .dark-mode .header {
            border-bottom-color: #333;
        }

        .header.with-back {
            justify-content: flex-start;
            gap: 16px;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            color: #1565C0;
        }

        .dark-mode .back-btn {
            color: #4FC3F7;
        }

        .page-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .dark-mode .page-title {
            color: #ffffff;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #1565C0, #00A651);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #1565C0;
        }

        .dark-mode .logo-text {
            color: #4FC3F7;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            color: #666;
        }

        .dark-mode .theme-toggle {
            color: #ccc;
        }

        .main-content {
            padding: 24px 20px;
            height: calc(100% - 160px);
            overflow-y: auto;
        }

        .greeting {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #1a1a1a;
        }

        .dark-mode .greeting {
            color: #ffffff;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
        }

        .dark-mode .subtitle {
            color: #999;
        }

        .balance-card {
            background: #1565C0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            color: white;
            position: relative;
            cursor: pointer;
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.8;
            font-weight: 500;
        }

        .status-indicator {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .balance-amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .balance-growth {
            font-size: 12px;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .dark-mode .section-title {
            color: #ffffff;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 32px;
        }

        .action-btn {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 16px;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark-mode .action-btn {
            background: #2a2a2a;
            border-color: #444;
            color: #fff;
        }

        .action-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        .deposit-icon { background: #4CAF50; }
        .withdraw-icon { background: #FF5722; }
        .transfer-icon { background: #2196F3; }
        .goal-icon { background: #FF9800; }

        .action-text {
            font-size: 14px;
            font-weight: 500;
        }

        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 88px;
            background: #fff;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 20px;
        }

        .dark-mode .bottom-nav {
            background: #2a2a2a;
            border-top-color: #444;
        }

        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            color: #666;
        }

        .dark-mode .nav-item {
            color: #999;
        }

        .nav-item.active {
            color: #1565C0;
        }

        .dark-mode .nav-item.active {
            color: #4FC3F7;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            display: block;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .dark-mode .form-label {
            color: #ffffff;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
            color: #1a1a1a;
        }

        .dark-mode .form-input {
            background: #2a2a2a;
            border-color: #444;
            color: #ffffff;
        }

        .form-input:focus {
            outline: none;
            border-color: #1565C0;
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
        }

        .primary-btn {
            width: 100%;
            background: #1565C0;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .secondary-btn {
            width: 100%;
            background: transparent;
            color: #1565C0;
            border: 1px solid #1565C0;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
        }

        .dark-mode .secondary-btn {
            color: #4FC3F7;
            border-color: #4FC3F7;
        }

        .secondary-btn:hover {
            background: #1565C0;
            color: white;
        }

        .amount-display {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin: 24px 0;
            color: #1565C0;
            min-height: 48px;
        }

        .dark-mode .amount-display {
            color: #4FC3F7;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .keypad-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            background: #f5f5f5;
            color: #1a1a1a;
        }

        .dark-mode .keypad-btn {
            background: #333;
            color: #ffffff;
        }

        .payment-methods {
            margin-top: 24px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .dark-mode .payment-method {
            border-color: #444;
        }

        .payment-method.selected {
            border-color: #1565C0;
            background: rgba(21, 101, 192, 0.05);
        }

        .payment-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .payment-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .mtn-icon { background: #FFCC00; color: #000; }
        .airtel-icon { background: #E60026; }
        .bank-icon { background: #1565C0; }

        .fee-notice {
            background: #FFF3CD;
            border: 1px solid #FFEAA7;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 14px;
            color: #856404;
        }

        .dark-mode .fee-notice {
            background: #3D3D00;
            border-color: #5D5D00;
            color: #FFEB3B;
        }

        .approval-notice {
            background: #E3F2FD;
            border: 1px solid #BBDEFB;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-size: 14px;
            color: #0D47A1;
        }

        .dark-mode .approval-notice {
            background: #1A237E;
            border-color: #3F51B5;
            color: #90CAF9;
        }

        .success-message {
            background: #D4EDDA;
            border: 1px solid #C3E6CB;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
            color: #155724;
        }

        .dark-mode .success-message {
            background: #1B4332;
            border-color: #2D5A3D;
            color: #4CAF50;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .dark-mode .transaction-item {
            border-bottom-color: #333;
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .deposit-transaction { background: #4CAF50; }
        .withdraw-transaction { background: #FF5722; }
        .transfer-transaction { background: #2196F3; }
        .pending-transaction { background: #FF9800; }

        .transaction-details h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .transaction-date {
            font-size: 12px;
            color: #666;
        }

        .dark-mode .transaction-date {
            color: #999;
        }

        .transaction-amount {
            font-size: 14px;
            font-weight: 600;
        }

        .positive { color: #4CAF50; }
        .negative { color: #FF5722; }
        .pending { color: #FF9800; }

        .profit-display {
            background: linear-gradient(135deg, #00A651, #4CAF50);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            color: white;
            text-align: center;
        }

        .profit-amount {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profit-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .pending-requests {
            background: #FFF3CD;
            border: 1px solid #FFEAA7;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .dark-mode .pending-requests {
            background: #3D3D00;
            border-color: #5D5D00;
        }

        .request-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #FFEAA7;
        }

        .dark-mode .request-item {
            border-bottom-color: #5D5D00;
        }

        .request-item:last-child {
            border-bottom: none;
        }

        .request-actions {
            display: flex;
            gap: 8px;
        }

        .approve-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .reject-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .dark-mode .settings-item {
            border-bottom-color: #333;
        }

        .settings-item:hover {
            background: rgba(0,0,0,0.02);
        }

        .dark-mode .settings-item:hover {
            background: rgba(255,255,255,0.02);
        }

        .settings-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }

        .profile-icon { background: #2196F3; }
        .security-icon { background: #FF9800; }
        .notification-icon { background: #9C27B0; }
        .support-icon { background: #4CAF50; }
        .logout-icon { background: #FF5722; }

        .terms-content {
            font-size: 14px;
            line-height: 1.6;
            color: #666;
        }

        .dark-mode .terms-content {
            color: #999;
        }

        .terms-section {
            margin-bottom: 24px;
        }

        .terms-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .dark-mode .terms-section h3 {
            color: #ffffff;
        }

        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 1px solid #e5e5e5;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            background: #fff;
            color: #666;
        }

        .dark-mode .filter-tab {
            background: #2a2a2a;
            border-color: #444;
            color: #999;
        }

        .filter-tab.active {
            background: #1565C0;
            color: white;
            border-color: #1565C0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .dark-mode .stat-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #1565C0;
        }

        .dark-mode .stat-value {
            color: #4FC3F7;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .dark-mode .stat-label {
            color: #999;
        }

        .goal-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .dark-mode .goal-card {
            background: #2a2a2a;
            border-color: #444;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .goal-name {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .dark-mode .goal-name {
            color: #ffffff;
        }

        .goal-amount {
            font-size: 14px;
            color: #666;
        }

        .dark-mode .goal-amount {
            color: #999;
        }

        .goal-progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .dark-mode .goal-progress-bar {
            background: #444;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1565C0, #00A651);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .goal-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        .dark-mode .goal-info {
            color: #999;
        }

        .empty-goals {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .dark-mode .empty-goals {
            color: #999;
        }

        .empty-goals-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen light-mode" id="screen">
            
                <!-- SIGNUP PAGE -->
                <div class="page" id="signup-page">
                    <div class="status-bar">
                        <span>Sign Up</span>
                    </div>
                    <div class="header with-back">
                        <button class="back-btn" onclick="showPage('home')">←</button>
                        <div class="page-title">Create Account</div>
                    </div>
                    <div class="main-content">
                        <form id="signup-form" onsubmit="handleSignup(event)">
                            <div class="form-group">
                                <label class="form-label" for="signup-username">Username</label>
                                <input class="form-input" type="text" id="signup-username" name="username" placeholder="Choose a username" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="signup-email">Email</label>
                                <input class="form-input" type="email" id="signup-email" name="email" placeholder="your.email@example.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="signup-password">Password</label>
                                <input class="form-input" type="password" id="signup-password" name="password" placeholder="At least 6 characters" minlength="6" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="signup-phone">Phone Number (Optional)</label>
                                <input class="form-input" type="tel" id="signup-phone" name="phone" placeholder="+250 7XX XXX XXX">
                            </div>
                            <button class="primary-btn" type="submit" id="signup-btn">Create Account</button>
                            <p style="text-align: center; margin-top: 16px; font-size: 14px; color: #666;">
                                Already have an account? <a href="#" onclick="showPage('home'); return false;" style="color: #1565C0; text-decoration: none;">Login</a>
                            </p>
                        </form>
                    </div>
                </div>
            
                <!-- HOME PAGE -->
            <div class="page active" id="home-page">
                <div class="status-bar">
                    <span id="current-time">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header">
                    <div class="logo">
                            <div class="logo-icon">A</div>
                        <div class="logo-text">AGASEKE</div>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
                </div>
                
                <div class="main-content">
                    <div class="greeting" id="user-greeting">Good morning, User</div>
                    <div class="subtitle">Your digital piggy bank is secure</div>
                    
                    <div class="balance-card" onclick="showPage('balance-details')">
                        <div class="balance-header">
                            <div class="balance-label">Total Savings Balance</div>
                            <div class="status-indicator">Protected</div>
                        </div>
                        <div class="balance-amount" id="total-balance">285,750 RWF</div>
                        <div class="balance-growth">
                            ▲ +5.2% this month • 12,450 RWF growth
                        </div>
                    </div>

                    <!-- Pending Withdrawal Requests -->
                    <div id="pending-requests-home" style="display: none;">
                        <div class="pending-requests">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #856404;">
                                🔒 Pending Withdrawal Requests
                            </div>
                            <div id="pending-list-home"></div>
                        </div>
                    </div>

                    <!-- Your Profit Display -->
                    <div class="profit-display">
                        <div class="profit-amount" id="total-profit">5,715 RWF</div>
                        <div class="profit-label">Your Total Profit (2% from withdrawals)</div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-btn" onclick="showPage('deposit')">
                            <div class="action-icon deposit-icon">+</div>
                            <div class="action-text">Deposit Money</div>
                        </button>
                        <button class="action-btn" onclick="showPage('withdraw')">
                            <div class="action-icon withdraw-icon">🔒</div>
                            <div class="action-text">Request Withdrawal</div>
                        </button>
                        <button class="action-btn" onclick="showPage('transfer')">
                            <div class="action-icon transfer-icon">→</div>
                            <div class="action-text">Send Money</div>
                        </button>
                            <button class="action-btn" onclick="showPage('goals'); loadGoals();">
                                <div class="action-icon goal-icon">🎯</div>
                                <div class="action-text">My Goals</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ACTIVITY/HISTORY PAGE -->
            <div class="page" id="activity-page">
                <div class="status-bar">
                    <span id="current-time-2">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Transaction History</div>
                </div>
                
                <div class="main-content">
                    <!-- Statistics -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-deposits">0</div>
                            <div class="stat-label">Total Deposits</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-withdrawals">0</div>
                            <div class="stat-label">Total Withdrawals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-transfers">0</div>
                            <div class="stat-label">Money Sent</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pending-count">0</div>
                            <div class="stat-label">Pending Requests</div>
                        </div>
                    </div>

                    <!-- Pending Withdrawal Requests -->
                    <div id="pending-requests-section" style="display: none;">
                        <div class="section-title">Pending Withdrawal Requests</div>
                        <div class="pending-requests">
                            <div id="pending-requests-list"></div>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <div class="filter-tabs">
                        <div class="filter-tab active" onclick="filterTransactions('all')">All</div>
                        <div class="filter-tab" onclick="filterTransactions('deposit')">Deposits</div>
                        <div class="filter-tab" onclick="filterTransactions('withdraw')">Withdrawals</div>
                        <div class="filter-tab" onclick="filterTransactions('transfer')">Transfers</div>
                        <div class="filter-tab" onclick="filterTransactions('pending')">Pending</div>
                    </div>

                    <!-- Transaction List -->
                    <div class="section-title">All Transactions</div>
                    <div id="transaction-list">
                        <!-- Transactions will be populated here -->
                    </div>
                </div>
            </div>

            <!-- ANALYTICS/TERMS PAGE -->
            <div class="page" id="analytics-page">
                <div class="status-bar">
                    <span id="current-time-3">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Terms & Conditions</div>
                </div>
                
                <div class="main-content">
                    <div class="terms-content">
                        <div class="terms-section">
                            <h3>🏦 AGASEKE Digital Piggy Bank</h3>
                            <p>Welcome to AGASEKE, Rwanda's premier digital piggy bank service designed to help you save money securely with built-in withdrawal protection.</p>
                        </div>

                        <div class="terms-section">
                            <h3>💰 Fee Structure</h3>
                            <p><strong>Deposits:</strong> FREE - No charges for adding money to your account</p>
                            <p><strong>Withdrawals:</strong> 2% service fee on all withdrawal amounts</p>
                            <p><strong>Transfers:</strong> Transfer fees apply based on amount:</p>
                            <p style="margin-left: 20px;">• 1 - 1,000 RWF: FREE</p>
                            <p style="margin-left: 20px;">• 1,001 - 5,000 RWF: 50 RWF fee</p>
                            <p style="margin-left: 20px;">• 5,001 - 15,000 RWF: 100 RWF fee</p>
                            <p style="margin-left: 20px;">• 15,001 - 50,000 RWF: 200 RWF fee</p>
                            <p style="margin-left: 20px;">• 50,001 - 200,000 RWF: 400 RWF fee</p>
                            <p style="margin-left: 20px;">• Above 200,000 RWF: 600 RWF fee</p>
                            <p><strong>Account Maintenance:</strong> FREE - No monthly or annual fees</p>
                        </div>

                        <div class="terms-section">
                            <h3>🔒 Withdrawal Protection System</h3>
                            <p>To maintain the "piggy bank" concept and help you save effectively:</p>
                            <p>• All withdrawal requests require approval from a designated second party</p>
                            <p>• This prevents impulsive spending and encourages long-term saving</p>
                            <p>• You can set up a trusted family member or friend as your approver</p>
                            <p>• Emergency withdrawals may be processed with additional verification</p>
                        </div>

                        <div class="terms-section">
                            <h3>📱 Supported Payment Methods</h3>
                            <p><strong>Mobile Money:</strong></p>
                            <p>• MTN Mobile Money</p>
                            <p>• Airtel Money</p>
                            <p><strong>Banking:</strong></p>
                            <p>• All major Rwandan banks</p>
                            <p>• Real-time transfers and deposits</p>
                        </div>

                        <div class="terms-section">
                            <h3>🛡️ Security & Privacy</h3>
                            <p>• Your money is secured with bank-level encryption</p>
                            <p>• All transactions are monitored for fraud protection</p>
                            <p>• Personal information is never shared with third parties</p>
                            <p>• 24/7 customer support available</p>
                        </div>

                        <div class="terms-section">
                            <h3>⚖️ Legal Terms</h3>
                            <p>• AGASEKE is licensed by the National Bank of Rwanda</p>
                            <p>• Funds are insured up to 5,000,000 RWF per account</p>
                            <p>• Disputes are resolved through Rwanda's financial mediation system</p>
                            <p>• Terms may be updated with 30 days notice</p>
                        </div>

                        <div class="terms-section">
                            <h3>📞 Contact Information</h3>
                            <p><strong>Customer Service:</strong> +250 786 739 043</p>
                            <p><strong>Email:</strong> anthonyregina48@gmail.com</p>
                            <p><strong>Office:</strong> KG 123 St, Kigali, Rwanda</p>
                            <p><strong>Hours:</strong> Monday - Friday, 8:00 AM - 6:00 PM</p>
                            <p><strong>Emergency Support:</strong> Available 24/7 for urgent issues</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div class="page" id="settings-page">
                <div class="status-bar">
                    <span id="current-time-4">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Settings</div>
                </div>
                
                <div class="main-content">
                    <div class="section-title">Account Settings</div>
                    
                    <div class="settings-item" onclick="showPage('profile')">
                        <div class="settings-info">
                            <div class="settings-icon profile-icon">👤</div>
                            <div>
                                <div style="font-weight: 600;">Profile Information</div>
                                <div style="font-size: 12px; color: #666;">Update your personal details</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>

                    <div class="settings-item" onclick="showPage('security')">
                        <div class="settings-info">
                            <div class="settings-icon security-icon">🔐</div>
                            <div>
                                <div style="font-weight: 600;">Security & Privacy</div>
                                <div style="font-size: 12px; color: #666;">Manage withdrawal approver, PIN</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>

                    <div class="settings-item" onclick="toggleNotifications()">
                        <div class="settings-info">
                            <div class="settings-icon notification-icon">🔔</div>
                            <div>
                                <div style="font-weight: 600;">Notifications</div>
                                <div style="font-size: 12px; color: #666;">Transaction alerts, reminders</div>
                            </div>
                        </div>
                        <div id="notification-toggle">ON</div>
                    </div>

                    <div class="section-title" style="margin-top: 32px;">App & Downloads</div>

                    <div class="settings-item" onclick="showPage('download-info')">
                        <div class="settings-info">
                            <div class="settings-icon" style="background: #FF9800;">📱</div>
                            <div>
                                <div style="font-weight: 600;">Download AGASEKE App</div>
                                <div style="font-size: 12px; color: #666;">Get mobile app, view regional pricing</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>

                    <div class="section-title" style="margin-top: 32px;">Support</div>

                    <div class="settings-item" onclick="contactSupport()">
                        <div class="settings-info">
                            <div class="settings-icon support-icon">💬</div>
                            <div>
                                <div style="font-weight: 600;">Customer Support</div>
                                <div style="font-size: 12px; color: #666;">Get help, report issues</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>

                    <div class="settings-item" onclick="showPage('analytics')">
                        <div class="settings-info">
                            <div class="settings-icon" style="background: #9C27B0;">📋</div>
                            <div>
                                <div style="font-weight: 600;">Terms & Conditions</div>
                                <div style="font-size: 12px; color: #666;">Read our terms and fees</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>

                    <div class="section-title" style="margin-top: 32px;">Account Actions</div>

                    <div class="settings-item" onclick="logout()">
                        <div class="settings-info">
                            <div class="settings-icon logout-icon">🚪</div>
                            <div>
                                <div style="font-weight: 600; color: #FF5722;">Logout</div>
                                <div style="font-size: 12px; color: #666;">Sign out of your account</div>
                            </div>
                        </div>
                        <div>→</div>
                    </div>
                </div>
            </div>

            <!-- APP DOWNLOAD INFO PAGE -->
            <div class="page" id="download-info-page">
                <div class="status-bar">
                    <span id="current-time-download">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('settings')">←</button>
                    <div class="page-title">Download AGASEKE</div>
                </div>
                
                <div class="main-content">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 60px; margin-bottom: 16px;">📱</div>
                        <h2 style="color: #1565C0; margin: 0;">AGASEKE Mobile App</h2>
                        <p style="color: #666; margin: 10px 0;">Your digital piggy bank, now on mobile!</p>
                    </div>

                    <!-- Location Detection -->
                    <div id="location-info" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <span style="margin-right: 8px;">🌍</span>
                            <strong>Detecting your location...</strong>
                        </div>
                        <div id="location-details" style="font-size: 14px; color: #666;">
                            Please wait while we determine your region for pricing...
                        </div>
                    </div>

                    <!-- Regional Pricing -->
                    <div id="pricing-info" style="display: none;">
                        <div class="terms-section">
                            <h3>💰 Regional Pricing</h3>
                            <div id="your-price" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #1565C0;">
                                <div style="font-weight: bold; color: #1565C0; margin-bottom: 5px;">Your Price:</div>
                                <div id="price-display" style="font-size: 24px; font-weight: bold; color: #1565C0;">Loading...</div>
                            </div>
                        </div>

                        <div class="terms-section">
                            <h3>🌍 Pricing by Region</h3>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <p><strong>🆓 East Africa (FREE):</strong></p>
                                <p style="margin-left: 20px; font-size: 14px;">• Rwanda, Uganda, Tanzania, Kenya, Burundi, South Sudan</p>
                                
                                <p style="margin-top: 15px;"><strong>💵 Africa ($2.99):</strong></p>
                                <p style="margin-left: 20px; font-size: 14px;">• All other African countries</p>
                                
                                <p style="margin-top: 15px;"><strong>💰 Developing Countries ($4.99):</strong></p>
                                <p style="margin-left: 20px; font-size: 14px;">• Asia (except Japan/Singapore), Latin America, Eastern Europe</p>
                                
                                <p style="margin-top: 15px;"><strong>💎 Developed Countries ($9.99):</strong></p>
                                <p style="margin-left: 20px; font-size: 14px;">• North America, Western Europe, Australia, Japan, Singapore</p>
                            </div>
                        </div>

                        <div class="terms-section">
                            <h3>Features Included</h3>
                            <p>• 📱 Native mobile app for Android & iOS</p>
                            <p>• 🔔 Push notifications for transactions</p>
                            <p>• 📊 Advanced analytics and spending insights</p>
                            <p>• 🔒 Enhanced security features</p>
                            <p>• 📞 Priority customer support</p>
                            <p>• 🎯 Savings goals with visual progress</p>
                            <p>• 💳 Offline transaction capability</p>
                        </div>

                        <div id="download-actions" style="margin-top: 30px;">
                            <button id="download-btn" class="primary-btn" onclick="initiateDownload()" style="width: 100%; margin-bottom: 15px;">
                                Download Now
                            </button>
                            
                            <div style="text-align: center; font-size: 12px; color: #666;">
                                <p>💳 Secure payment via MTN Mobile Money, Airtel Money, or Bank Transfer</p>
                                <p>📧 Download link will be sent to: anthonyregina48@gmail.com</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact for Issues -->
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffeaa7;">
                        <div style="font-weight: bold; margin-bottom: 8px; color: #856404;">
                            📞 Need Help?
                        </div>
                        <p style="margin: 5px 0; font-size: 14px; color: #856404;">
                            <strong>Customer Service:</strong> +250 786 739 043
                        </p>
                        <p style="margin: 5px 0; font-size: 14px; color: #856404;">
                            <strong>Email:</strong> anthonyregina48@gmail.com
                        </p>
                        <p style="margin: 5px 0; font-size: 14px; color: #856404;">
                            Available Monday - Friday, 8:00 AM - 6:00 PM (EAT)
                        </p>
                    </div>
                </div>
            </div>

            <!-- WITHDRAW PAGE (Updated with Approval System) -->
            <div class="page" id="withdraw-page">
                <div class="status-bar">
                    <span id="current-time-5">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Request Withdrawal</div>
                </div>
                
                <div class="main-content">
                    <div class="approval-notice">
                        <strong>🔒 Withdrawal Protection Active</strong><br>
                        All withdrawal requests require approval from your designated approver (Support - +250 786 739 043) to maintain your savings discipline.
                    </div>

                    <div class="amount-display" id="withdraw-amount-display">0 RWF</div>
                    
                    <div class="fee-notice">
                        <strong>Withdrawal Fee:</strong> 2% service charge applies to all withdrawals. This helps us maintain and improve our services.
                    </div>
                    
                    <div class="keypad">
                        <button class="keypad-btn" onclick="addToAmount('1', 'withdraw')">1</button>
                        <button class="keypad-btn" onclick="addToAmount('2', 'withdraw')">2</button>
                        <button class="keypad-btn" onclick="addToAmount('3', 'withdraw')">3</button>
                        <button class="keypad-btn" onclick="addToAmount('4', 'withdraw')">4</button>
                        <button class="keypad-btn" onclick="addToAmount('5', 'withdraw')">5</button>
                        <button class="keypad-btn" onclick="addToAmount('6', 'withdraw')">6</button>
                        <button class="keypad-btn" onclick="addToAmount('7', 'withdraw')">7</button>
                        <button class="keypad-btn" onclick="addToAmount('8', 'withdraw')">8</button>
                        <button class="keypad-btn" onclick="addToAmount('9', 'withdraw')">9</button>
                        <button class="keypad-btn" onclick="addToAmount('.', 'withdraw')">.</button>
                        <button class="keypad-btn" onclick="addToAmount('0', 'withdraw')">0</button>
                        <button class="keypad-btn" onclick="deleteAmount('withdraw')">⌫</button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Reason for Withdrawal</label>
                        <input type="text" class="form-input" placeholder="e.g., Emergency, School fees, etc." id="withdrawal-reason">
                    </div>

                    <div class="payment-methods">
                        <div class="section-title">Select Withdrawal Destination</div>

                        <div class="payment-method" onclick="selectPaymentMethod('MTN Mobile Money', 'withdraw')">
                            <div class="payment-info">
                                <div class="payment-icon mtn-icon">M</div>
                                <div>
                                    <div style="font-weight: 600;">MTN Mobile Money</div>
                                    <div style="font-size: 12px; color: #666;">**** **** 1234</div>
                                </div>
                            </div>
                            <div id="mtn-check-withdraw">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Airtel Money', 'withdraw')">
                            <div class="payment-info">
                                <div class="payment-icon airtel-icon">A</div>
                                <div>
                                    <div style="font-weight: 600;">Airtel Money</div>
                                    <div style="font-size: 12px; color: #666;">**** **** 5678</div>
                                </div>
                            </div>
                            <div id="airtel-check-withdraw">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Bank Transfer', 'withdraw')">
                            <div class="payment-info">
                                <div class="payment-icon bank-icon">B</div>
                                <div>
                                    <div style="font-weight: 600;">Bank Transfer</div>
                                    <div style="font-size: 12px; color: #666;">BK **** 9012</div>
                                </div>
                            </div>
                            <div id="bank-check-withdraw">○</div>
                        </div>
                    </div>

                    <div id="withdrawal-summary" style="display: none;">
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin: 16px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Withdrawal Amount:</span>
                                <span id="withdrawal-base-amount">0 RWF</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Service Fee (2%):</span>
                                <span id="withdrawal-fee">0 RWF</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ddd; padding-top: 8px;">
                                <span>You'll Receive:</span>
                                <span id="withdrawal-net-amount">0 RWF</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="primary-btn" onclick="requestWithdrawal()">
                        Submit Withdrawal Request
                    </button>
                </div>
            </div>

            <!-- Other pages remain the same but I'll include the essential ones -->
            
            <!-- DEPOSIT PAGE -->
            <div class="page" id="deposit-page">
                <div class="status-bar">
                    <span id="current-time-6">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Deposit Money</div>
                </div>
                
                <div class="main-content">
                    <div class="amount-display" id="deposit-amount-display">0 RWF</div>
                    
                    <div class="keypad">
                        <button class="keypad-btn" onclick="addToAmount('1', 'deposit')">1</button>
                        <button class="keypad-btn" onclick="addToAmount('2', 'deposit')">2</button>
                        <button class="keypad-btn" onclick="addToAmount('3', 'deposit')">3</button>
                        <button class="keypad-btn" onclick="addToAmount('4', 'deposit')">4</button>
                        <button class="keypad-btn" onclick="addToAmount('5', 'deposit')">5</button>
                        <button class="keypad-btn" onclick="addToAmount('6', 'deposit')">6</button>
                        <button class="keypad-btn" onclick="addToAmount('7', 'deposit')">7</button>
                        <button class="keypad-btn" onclick="addToAmount('8', 'deposit')">8</button>
                        <button class="keypad-btn" onclick="addToAmount('9', 'deposit')">9</button>
                        <button class="keypad-btn" onclick="addToAmount('.', 'deposit')">.</button>
                        <button class="keypad-btn" onclick="addToAmount('0', 'deposit')">0</button>
                        <button class="keypad-btn" onclick="deleteAmount('deposit')">⌫</button>
                    </div>

                    <div class="payment-methods">
                        <div class="section-title">Select Payment Source</div>

                        <div class="payment-method" onclick="selectPaymentMethod('MTN Mobile Money', 'deposit')">
                            <div class="payment-info">
                                <div class="payment-icon mtn-icon">M</div>
                                <div>
                                    <div style="font-weight: 600;">MTN Mobile Money</div>
                                    <div style="font-size: 12px; color: #666;">**** **** 1234</div>
                                </div>
                            </div>
                            <div id="mtn-check-deposit">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Airtel Money', 'deposit')">
                            <div class="payment-info">
                                <div class="payment-icon airtel-icon">A</div>
                                <div>
                                    <div style="font-weight: 600;">Airtel Money</div>
                                    <div style="font-size: 12px; color: #666;">**** **** 5678</div>
                                </div>
                            </div>
                            <div id="airtel-check-deposit">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Bank Transfer', 'deposit')">
                            <div class="payment-info">
                                <div class="payment-icon bank-icon">B</div>
                                <div>
                                    <div style="font-weight: 600;">Bank Transfer</div>
                                    <div style="font-size: 12px; color: #666;">BK **** 9012</div>
                                </div>
                            </div>
                            <div id="bank-check-deposit">○</div>
                        </div>
                    </div>
                    
                    <button class="primary-btn" onclick="processDeposit()">
                        Confirm Deposit
                    </button>
                </div>
            </div>

            <!-- TRANSFER PAGE -->
            <div class="page" id="transfer-page">
                <div class="status-bar">
                    <span id="current-time-7">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Send Money</div>
                </div>
                
                <div class="main-content">
                    <div class="form-group">
                        <label class="form-label">Recipient Phone Number</label>
                        <input type="tel" class="form-input" placeholder="078XXXXXXX or +250XXXXXXXXX" id="recipient-phone">
                    </div>

                    <div class="amount-display" id="transfer-amount-display">0 RWF</div>
                    
                    <!-- Transfer Fee Display -->
                    <div id="transfer-fee-display" style="display: none; background: #fff3cd; padding: 12px; border-radius: 8px; margin: 16px 0; border: 1px solid #ffeaa7;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Transfer Amount:</span>
                            <span id="transfer-base-amount">0 RWF</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Transfer Fee:</span>
                            <span id="transfer-fee-amount">0 RWF</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #ddd; padding-top: 8px;">
                            <span>Total to Deduct:</span>
                            <span id="transfer-total-amount">0 RWF</span>
                        </div>
                        <div style="font-size: 12px; color: #856404; margin-top: 8px;">
                            💡 <strong>Fee Structure:</strong> Up to 1,000 = FREE • 1,001-5,000 = 50 RWF • 5,001-15,000 = 100 RWF • 15,001-50,000 = 200 RWF • 50,001-200,000 = 400 RWF • Above 200,000 = 600 RWF
                        </div>
                    </div>
                    
                    <div class="keypad">
                        <button class="keypad-btn" onclick="addToAmount('1', 'transfer')">1</button>
                        <button class="keypad-btn" onclick="addToAmount('2', 'transfer')">2</button>
                        <button class="keypad-btn" onclick="addToAmount('3', 'transfer')">3</button>
                        <button class="keypad-btn" onclick="addToAmount('4', 'transfer')">4</button>
                        <button class="keypad-btn" onclick="addToAmount('5', 'transfer')">5</button>
                        <button class="keypad-btn" onclick="addToAmount('6', 'transfer')">6</button>
                        <button class="keypad-btn" onclick="addToAmount('7', 'transfer')">7</button>
                        <button class="keypad-btn" onclick="addToAmount('8', 'transfer')">8</button>
                        <button class="keypad-btn" onclick="addToAmount('9', 'transfer')">9</button>
                        <button class="keypad-btn" onclick="addToAmount('.', 'transfer')">.</button>
                        <button class="keypad-btn" onclick="addToAmount('0', 'transfer')">0</button>
                        <button class="keypad-btn" onclick="deleteAmount('transfer')">⌫</button>
                    </div>

                    <div class="payment-methods">
                        <div class="section-title">Select Transfer Method</div>

                        <div class="payment-method" onclick="selectPaymentMethod('MTN Mobile Money', 'transfer')">
                            <div class="payment-info">
                                <div class="payment-icon mtn-icon">M</div>
                                <div>
                                    <div style="font-weight: 600;">MTN Mobile Money</div>
                                    <div style="font-size: 12px; color: #666;">Send to MTN number</div>
                                </div>
                            </div>
                            <div id="mtn-check-transfer">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Airtel Money', 'transfer')">
                            <div class="payment-info">
                                <div class="payment-icon airtel-icon">A</div>
                                <div>
                                    <div style="font-weight: 600;">Airtel Money</div>
                                    <div style="font-size: 12px; color: #666;">Send to Airtel number</div>
                                </div>
                            </div>
                            <div id="airtel-check-transfer">○</div>
                        </div>

                        <div class="payment-method" onclick="selectPaymentMethod('Bank Transfer', 'transfer')">
                            <div class="payment-info">
                                <div class="payment-icon bank-icon">B</div>
                                <div>
                                    <div style="font-weight: 600;">Bank Transfer</div>
                                    <div style="font-size: 12px; color: #666;">Send to bank account</div>
                                </div>
                            </div>
                            <div id="bank-check-transfer">○</div>
                        </div>
                    </div>
                    
                    <button class="primary-btn" onclick="processTransfer()">
                        Send Money
                    </button>
                </div>
            </div>

            <!-- NEW GOAL PAGE -->
            <div class="page" id="new-goal-page">
                <div class="status-bar">
                    <span id="current-time-8">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">Create New Goal</div>
                </div>
                
                <div class="main-content">
                    <div class="form-group">
                        <label class="form-label">Goal Name</label>
                        <input type="text" class="form-input" placeholder="e.g., New Car, Vacation" id="goal-name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Target Amount (RWF)</label>
                        <input type="number" class="form-input" placeholder="500,000" id="goal-amount">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Target Date</label>
                        <input type="date" class="form-input" id="goal-date">
                    </div>
                    
                    <button class="primary-btn" onclick="createGoal()">
                        Create Savings Goal
                    </button>
                </div>
            </div>

            <!-- MY GOALS PAGE -->
            <div class="page" id="goals-page">
                <div class="status-bar">
                    <span id="current-time-9">9:41</span>
                    <span>●●●●● 100%</span>
                </div>
                
                <div class="header with-back">
                    <button class="back-btn" onclick="showPage('home')">←</button>
                    <div class="page-title">My Goals</div>
                </div>
                
                <div class="main-content">
                    <div id="goals-list"></div>
                    
                    <button class="secondary-btn" onclick="showPage('new-goal')">
                        + Create New Goal
                    </button>
                </div>
            </div>
            
            <!-- BOTTOM NAVIGATION -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="showPage('home')">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-label">Home</span>
                </div>
                <div class="nav-item" onclick="showPage('activity')">
                    <span class="nav-icon">📊</span>
                    <span class="nav-label">Activity</span>
                </div>
                <div class="nav-item" onclick="showPage('analytics')">
                    <span class="nav-icon">📋</span>
                    <span class="nav-label">Terms</span>
                </div>
                <div class="nav-item" onclick="showPage('settings')">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-label">Settings</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let depositAmount = '';
        let withdrawAmount = '';
        let transferAmount = '';
        let selectedDepositMethod = '';
        let selectedWithdrawMethod = '';
        let selectedTransferMethod = '';
        let isDarkMode = false;
        let totalBalance = 0;
        let totalProfit = 0;
        let notificationsEnabled = true;
        let currentFilter = 'all';
        let currentUser = null;
        let authToken = localStorage.getItem('authToken');
        let transactions = [];
        let pendingWithdrawals = [];
        
        // Contact database for auto-completing recipient names
        let contactDatabase = [
            { phone: '+250788123456', name: 'Mom' },
            { phone: '+250788123457', name: 'Dad' },
            { phone: '+250788123458', name: 'Sister Sarah' },
            { phone: '+250788123459', name: 'Brother John' },
            { phone: '+250781234567', name: 'Alice Uwimana' },
            { phone: '+250781234568', name: 'Jean Claude' },
            { phone: '+250781234569', name: 'Grace Mukamana' },
            { phone: '+250781234570', name: 'Patrick Nzeyimana' },
            { phone: '+250782123456', name: 'Marie Nyirahabimana' },
            { phone: '+250782123457', name: 'David Bizimana' },
            { phone: '+250783123456', name: 'Emmanuel Kagame' },
            { phone: '+250783123457', name: 'Claudine Mukamazimpaka' },
        ];

        // API Configuration
        const API_BASE_URL = 'http://192.168.1.45:3001/api';
        
        // API Helper Functions
        async function apiCall(endpoint, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` })
                }
            };
            
            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };

            try {
                console.log(`🔗 API Call: ${endpoint}`, mergedOptions);
                const response = await fetch(`${API_BASE_URL}${endpoint}`, mergedOptions);
                
                console.log(`📡 Response Status: ${response.status} ${response.statusText}`);
                
                let data;
                try {
                    data = await response.json();
                } catch (parseError) {
                    console.error('❌ JSON Parse Error:', parseError);
                    throw new Error('Invalid response format from server');
                }
                
                console.log('📄 Response Data:', data);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // Token expired or invalid
                        console.log('🔐 Authentication failed, redirecting to login');
                        logout();
                        return null;
                    }
                    throw new Error(data.message || `Server error: ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('❌ API Error:', error);
                
                // More specific error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    alert('❌ Cannot connect to server. Make sure the backend is running on http://localhost:3000');
                } else if (error.message.includes('CORS')) {
                    alert('❌ CORS error. Check browser console for details.');
                } else {
                    alert('❌ Error: ' + error.message);
                }
                return null;
            }
        }

        // Authentication Functions
        async function checkAuth() {
            if (!authToken) {
                showLoginPage();
                return false;
            }
            
            const result = await apiCall('/auth/profile');
            if (result && result.success) {
                currentUser = result.user;
                totalBalance = currentUser.balance;
                totalProfit = currentUser.totalProfit;
                updateBalanceDisplay();
                return true;
            } else {
                showLoginPage();
                return false;
            }
        }

        async function login(identifier, password) {
            const result = await apiCall('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ identifier, password })
            });
            
            if (result && result.success) {
                authToken = result.token;
                localStorage.setItem('authToken', authToken);
                currentUser = result.user;
                totalBalance = currentUser.balance;
                totalProfit = currentUser.totalProfit;
                updateBalanceDisplay();
                showPage('home');
                return true;
            }
            return false;
        }

        async function register(userData) {
            const result = await apiCall('/auth/register', {
                method: 'POST',
                body: JSON.stringify(userData)
            });
            
            if (result && result.success) {
                authToken = result.token;
                localStorage.setItem('authToken', authToken);
                currentUser = result.user;
                totalBalance = currentUser.balance;
                totalProfit = currentUser.totalProfit;
                updateBalanceDisplay();
                showPage('home');
                return true;
            }
            return false;
        }

        function showLoginPage() {
            // Create login/register modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #1565C0; margin: 0;">Welcome to AGASEKE</h2>
                        <p style="color: #666; margin: 10px 0 0 0;">Your Digital Piggy Bank</p>
                    </div>
                    
                    <div id="login-form">
                        <h3 style="margin-bottom: 20px;">Login</h3>
                        <input type="text" id="login-identifier" placeholder="Email or Phone" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="password" id="login-password" placeholder="Password" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <button onclick="handleLogin()" style="width: 100%; padding: 12px; background: #1565C0; color: white; border: none; border-radius: 8px; margin: 10px 0; cursor: pointer;">Login</button>
                        <p style="text-align: center; margin: 20px 0;">
                            Don't have an account? 
                            <a href="#" onclick="showRegisterForm()" style="color: #1565C0; text-decoration: none;">Register here</a>
                        </p>
                    </div>
                    
                    <div id="register-form" style="display: none;">
                        <h3 style="margin-bottom: 20px;">Register</h3>
                        <input type="text" id="register-fullname" placeholder="Full Name" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="email" id="register-email" placeholder="Email" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="tel" id="register-phone" placeholder="Phone Number" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="password" id="register-password" placeholder="Password" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="text" id="register-pin" placeholder="4-digit PIN" maxlength="4" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="text" id="register-approver-name" placeholder="Approver Name (Optional)" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <input type="tel" id="register-approver-phone" placeholder="Approver Phone (Optional)" style="width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px;">
                        <button onclick="handleRegister()" style="width: 100%; padding: 12px; background: #1565C0; color: white; border: none; border-radius: 8px; margin: 10px 0; cursor: pointer;">Register</button>
                        <p style="text-align: center; margin: 20px 0;">
                            Already have an account? 
                            <a href="#" onclick="showLoginForm()" style="color: #1565C0; text-decoration: none;">Login here</a>
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.authModal = modal;
        }

        function showRegisterForm() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
        }

        function showLoginForm() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        }

        async function handleLogin() {
            const identifier = document.getElementById('login-identifier').value;
            const password = document.getElementById('login-password').value;
            
            if (!identifier || !password) {
                alert('Please enter both email/phone and password');
                return;
            }
            
            const success = await login(identifier, password);
            if (success) {
                document.body.removeChild(window.authModal);
                loadUserData();
            }
        }

        async function handleRegister() {
            const fullName = document.getElementById('register-fullname').value;
            const email = document.getElementById('register-email').value;
            const phoneNumber = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const pin = document.getElementById('register-pin').value;
            const approverName = document.getElementById('register-approver-name').value;
            const approverPhone = document.getElementById('register-approver-phone').value;
            
            if (!fullName || !email || !phoneNumber || !password || !pin) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                alert('PIN must be exactly 4 digits');
                return;
            }
            
            const userData = {
                fullName,
                email,
                phoneNumber,
                password,
                confirmPassword,
                pin,
                approverName: approverName || undefined,
                approverPhone: approverPhone || undefined
            };
            
            const success = await register(userData);
            if (success) {
                document.body.removeChild(window.authModal);
                loadUserData();
            }
        }

        // handle signup from dedicated signup page
        async function handleSignup(e) {
            e.preventDefault();
            
            const username = document.getElementById('signup-username').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const phone = document.getElementById('signup-phone').value.trim();
            
            if (!username || !email || !password) {
                alert('Please fill all required fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            const btn = document.getElementById('signup-btn');
            btn.disabled = true;
            btn.textContent = 'Creating...';
            
            const userData = {
                fullName: username,
                email: email,
                phoneNumber: phone || undefined,
                password: password,
                confirmPassword: password,
                pin: '0000'  // default pin, user can change later
            };
            
            const success = await register(userData);
            
            btn.disabled = false;
            btn.textContent = 'Create Account';
            
            if (success) {
                alert('Account created successfully!');
                showPage('home');
            }
        }

        function updateBalanceDisplay() {
            const balanceElement = document.getElementById('total-balance');
            if (balanceElement) {
                balanceElement.textContent = totalBalance.toLocaleString() + ' RWF';
            }
            
            const profitElement = document.getElementById('total-profit');
            if (profitElement) {
                profitElement.textContent = totalProfit.toLocaleString() + ' RWF';
            }
            
            // Update user greeting with actual name and time-based greeting
            const greetingElement = document.getElementById('user-greeting');
            if (greetingElement && currentUser) {
                const hour = new Date().getHours();
                let timeGreeting;
                
                if (hour < 12) {
                    timeGreeting = 'Good morning';
                } else if (hour < 17) {
                    timeGreeting = 'Good afternoon';
                } else {
                    timeGreeting = 'Good evening';
                }
                
                // Get first name from full name
                const firstName = currentUser.fullName.split(' ')[0];
                greetingElement.textContent = `${timeGreeting}, ${firstName}`;
            }
        }

        // Load user data from API
        async function loadUserData() {
            await loadTransactions();
            await loadPendingWithdrawals();
            updateBalanceDisplay();
        }

        async function loadTransactions() {
            const result = await apiCall('/transactions');
            if (result && result.success) {
                transactions = result.transactions;
            }
        }

        async function loadPendingWithdrawals() {
            const result = await apiCall('/transactions/pending-withdrawals');
            if (result && result.success) {
                pendingWithdrawals = result.pendingWithdrawals;
            }
        }

        // Phone number lookup functions
        async function lookupRecipientName() {
            const phoneInput = document.getElementById('recipient-phone');
            const nameInput = document.getElementById('recipient-name');
            const nameStatus = document.getElementById('name-status');
            const suggestions = document.getElementById('phone-suggestions');
            
            let phoneNumber = phoneInput.value.trim();
            
            // Clean up phone number format
            if (phoneNumber.startsWith('078') || phoneNumber.startsWith('079') || phoneNumber.startsWith('072') || phoneNumber.startsWith('073')) {
                phoneNumber = '+25' + phoneNumber;
            }
            
            // Clear previous state
            nameInput.value = '';
            nameInput.style.background = '#f8f9fa';
            suggestions.style.display = 'none';
            suggestions.innerHTML = '';
            
            if (phoneNumber.length < 10) {
                nameStatus.textContent = 'Enter phone number to auto-fill name';
                nameStatus.style.color = '#666';
                return;
            }
            
            // Look for exact matches in local contacts first
            const exactMatch = contactDatabase.find(contact => 
                contact.phone === phoneNumber || 
                contact.phone === phoneInput.value ||
                contact.phone.replace('+25', '') === phoneInput.value
            );
            
            if (exactMatch) {
                nameInput.value = exactMatch.name;
                nameInput.style.background = '#d4edda';
                nameStatus.textContent = '✅ Contact found in your contacts';
                nameStatus.style.color = '#155724';
                return;
            }
            
            // Check if it's a registered user
            try {
                const response = await fetch(`http://localhost:3000/api/auth/lookup/${phoneNumber}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        nameInput.value = data.user.fullName;
                        nameInput.style.background = '#cce5ff';
                        nameStatus.textContent = '✅ Piggy Bank user found';
                        nameStatus.style.color = '#0066cc';
                        return;
                    }
                }
            } catch (error) {
                console.log('Backend lookup failed, continuing with local search');
            }
            
            // Look for partial matches for suggestions
            const partialMatches = contactDatabase.filter(contact =>
                contact.phone.includes(phoneInput.value) ||
                contact.name.toLowerCase().includes(phoneInput.value.toLowerCase())
            );
            
            if (partialMatches.length > 0 && phoneInput.value.length >= 3) {
                showPhoneSuggestions(partialMatches, phoneInput, nameInput);
            } else if (phoneNumber.length >= 10) {
                // Valid phone number but not in contacts
                nameInput.value = '';
                nameInput.style.background = '#fff3cd';
                nameInput.placeholder = 'Enter recipient name manually';
                nameInput.readOnly = false;
                nameStatus.textContent = '⚠️ Contact not found. Please enter name manually.';
                nameStatus.style.color = '#856404';
            }
        }
        
        function showPhoneSuggestions(matches, phoneInput, nameInput) {
            const suggestions = document.getElementById('phone-suggestions');
            suggestions.innerHTML = '';
            suggestions.style.display = 'block';
            
            matches.forEach(contact => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.style.cssText = `
                    padding: 12px;
                    cursor: pointer;
                    border-bottom: 1px solid #eee;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                suggestionDiv.innerHTML = `
                    <div>
                        <div style="font-weight: 600; color: #333;">${contact.name}</div>
                        <div style="font-size: 12px; color: #666;">${contact.phone}</div>
                    </div>
                    <div style="color: #007bff;">Select</div>
                `;
                
                suggestionDiv.addEventListener('click', () => {
                    phoneInput.value = contact.phone.startsWith('+25') ? contact.phone.substring(3) : contact.phone;
                    nameInput.value = contact.name;
                    nameInput.style.background = '#d4edda';
                    document.getElementById('name-status').textContent = '✅ Contact selected';
                    document.getElementById('name-status').style.color = '#155724';
                    suggestions.style.display = 'none';
                });
                
                suggestionDiv.addEventListener('mouseenter', () => {
                    suggestionDiv.style.background = '#f8f9fa';
                });
                
                suggestionDiv.addEventListener('mouseleave', () => {
                    suggestionDiv.style.background = 'white';
                });
                
                suggestions.appendChild(suggestionDiv);
            });
        }
        
        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            const suggestions = document.getElementById('phone-suggestions');
            const phoneInput = document.getElementById('recipient-phone');
            
            if (suggestions && phoneInput && 
                !suggestions.contains(e.target) && 
                !phoneInput.contains(e.target)) {
                suggestions.style.display = 'none';
            }
        });
        
        // Regional Download Pricing System
        let userRegion = null;
        let downloadPrice = 0;

        // Geo-location and pricing functions
        async function detectUserLocation() {
            try {
                // First try to get user's IP-based location
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                const country = data.country_name || 'Unknown';
                const countryCode = data.country_code || 'XX';
                const continent = data.continent_code || 'XX';
                
                // Determine pricing region
                const pricing = determineRegionalPricing(countryCode, continent, country);
                
                // Update UI
                document.getElementById('location-details').innerHTML = `
                    📍 <strong>Detected Location:</strong> ${country}<br>
                    💰 <strong>Region:</strong> ${pricing.regionName}
                `;
                
                document.getElementById('price-display').textContent = pricing.price;
                document.getElementById('pricing-info').style.display = 'block';
                
                // Update download button
                const downloadBtn = document.getElementById('download-btn');
                if (pricing.isFree) {
                    downloadBtn.textContent = 'Download Free';
                    downloadBtn.style.background = '#4CAF50';
                } else {
                    downloadBtn.textContent = `Purchase & Download (${pricing.price})`;
                    downloadBtn.style.background = '#1565C0';
                }
                
                userRegion = pricing;
                
            } catch (error) {
                console.error('Location detection failed:', error);
                
                // Fallback: assume outside East Africa
                document.getElementById('location-details').innerHTML = `
                    ⚠️ <strong>Location detection failed</strong><br>
                    💰 Default pricing will apply
                `;
                
                const fallbackPricing = {
                    regionName: 'International',
                    price: '$4.99',
                    isFree: false,
                    usdAmount: 4.99
                };
                
                document.getElementById('price-display').textContent = fallbackPricing.price;
                document.getElementById('pricing-info').style.display = 'block';
                document.getElementById('download-btn').textContent = `Purchase & Download (${fallbackPricing.price})`;
                
                userRegion = fallbackPricing;
            }
        }

        function determineRegionalPricing(countryCode, continent, countryName) {
            // East Africa countries (FREE)
            const eastAfricaCountries = ['RW', 'UG', 'TZ', 'KE', 'BI', 'SS'];
            if (eastAfricaCountries.includes(countryCode)) {
                return {
                    regionName: 'East Africa',
                    price: 'FREE',
                    isFree: true,
                    usdAmount: 0
                };
            }
            
            // Other African countries ($2.99)
            if (continent === 'AF') {
                return {
                    regionName: 'Africa',
                    price: '$2.99',
                    isFree: false,
                    usdAmount: 2.99
                };
            }
            
            // Developed countries ($9.99)
            const developedCountries = [
                'US', 'CA', 'GB', 'FR', 'DE', 'IT', 'ES', 'NL', 'BE', 'CH', 'AT', 'SE', 'NO', 'DK', 'FI', 'IE', 'LU',
                'AU', 'NZ', 'JP', 'SG', 'KR', 'IL'
            ];
            if (developedCountries.includes(countryCode)) {
                return {
                    regionName: 'Developed Countries',
                    price: '$9.99',
                    isFree: false,
                    usdAmount: 9.99
                };
            }
            
            // Developing countries ($4.99) - Default for everything else
            return {
                regionName: 'Developing Countries',
                price: '$4.99',
                isFree: false,
                usdAmount: 4.99
            };
        }

        function initiateDownload() {
            if (!userRegion) {
                alert('❌ Please wait for location detection to complete.');
                return;
            }
            
            if (userRegion.isFree) {
                // Free download for East Africa
                alert(`Congratulations!\n\nAs you're in ${userRegion.regionName}, the AGASEKE app is FREE for you!\n\nDownload links for Android and iOS will be sent to:\nanthonyregina48@gmail.com\n\nNeed help? Contact +250 786 739 043`);
                
                // Here you would normally trigger the actual download/email sending
                // For demo purposes, we'll just show success
                showDownloadSuccess(true);
                
            } else {
                // Paid download - show payment options
                const confirmed = confirm(`💳 Purchase AGASEKE App\n\nPrice: ${userRegion.price}\nRegion: ${userRegion.regionName}\n\nPayment methods:\n• MTN Mobile Money\n• Airtel Money  \n• Bank Transfer\n\n📧 Download link sent to: anthonyregina48@gmail.com\n\nProceed with purchase?`);
                
                if (confirmed) {
                    showPaymentModal();
                }
            }
        }

        function showPaymentModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="color: #1565C0; margin: 0;">Purchase AGASEKE App</h2>
                        <p style="color: #666; margin: 10px 0 0 0;">Price: ${userRegion.price}</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>Select Payment Method:</h4>
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;" onclick="processPayment('mtn')">
                            📱 MTN Mobile Money
                        </div>
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;" onclick="processPayment('airtel')">
                            📱 Airtel Money
                        </div>
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;" onclick="processPayment('bank')">
                            🏦 Bank Transfer
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px;">Cancel</button>
                    </div>
                    
                    <div style="font-size: 12px; color: #666; margin-top: 15px; text-align: center;">
                        📞 Need help? Contact +250 786 739 043<br>
                        📧 anthonyregina48@gmail.com
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.paymentModal = modal;
        }

        function processPayment(method) {
            const methodNames = {
                'mtn': 'MTN Mobile Money',
                'airtel': 'Airtel Money', 
                'bank': 'Bank Transfer'
            };
            
            alert(`💳 ${methodNames[method]} Payment\n\nPrice: ${userRegion.price}\n\n📞 For payment assistance, please contact:\n+250 786 739 043\nanthonyregina48@gmail.com\n\nAfter payment confirmation, download links will be sent to your email within 24 hours.`);
            
            if (window.paymentModal) {
                document.body.removeChild(window.paymentModal);
            }
            
            showDownloadSuccess(false);
        }

        function showDownloadSuccess(isFree) {
            const message = isFree ? 
                'Free download initiated! Check your email for download links.' :
                '✅ Payment initiated! Download links will be sent after payment confirmation.';
                
            alert(message);
            showPage('settings'); // Go back to settings
        }

        // Initialize location detection when download page is shown
        // (This is handled in the main showPage function above)

        // Update time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            // Update all time displays
            for (let i = 1; i <= 8; i++) {
                const timeElement = document.getElementById(`current-time${i === 1 ? '' : '-' + i}`);
                if (timeElement) {
                    timeElement.textContent = timeString;
                }
            }
        }

        // Show page function
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });

            // Highlight active nav item and load data
            if (pageId === 'home') {
                navItems[0].classList.add('active');
                updatePendingRequestsHome();
            } else if (pageId === 'activity') {
                navItems[1].classList.add('active');
                loadActivityPage();
            } else if (pageId === 'analytics') {
                navItems[2].classList.add('active');
            } else if (pageId === 'settings') {
                navItems[3].classList.add('active');
            } else if (pageId === 'download-info') {
                // Special handling for download page - detect location
                setTimeout(() => {
                    detectUserLocation();
                }, 500);
            }
            
            // Update time for the current page
            updateTime();
        }

        // Toggle theme
        function toggleTheme() {
            const screen = document.getElementById('screen');
            const themeToggle = document.querySelector('.theme-toggle');
            
            isDarkMode = !isDarkMode;
            
            if (isDarkMode) {
                screen.classList.remove('light-mode');
                screen.classList.add('dark-mode');
                themeToggle.textContent = '☀️';
            } else {
                screen.classList.remove('dark-mode');
                screen.classList.add('light-mode');
                themeToggle.textContent = '🌙';
            }
        }

        // Transfer fee calculation function
        function calculateTransferFee(amount) {
            const numAmount = parseFloat(amount) || 0;
            
            if (numAmount <= 1000) {
                return 0; // FREE for 1-1,000 RWF
            } else if (numAmount <= 5000) {
                return 50; // 50 RWF fee for 1,001-5,000 RWF
            } else if (numAmount <= 15000) {
                return 100; // 100 RWF fee for 5,001-15,000 RWF
            } else if (numAmount <= 50000) {
                return 200; // 200 RWF fee for 15,001-50,000 RWF
            } else if (numAmount <= 200000) {
                return 400; // 400 RWF fee for 50,001-200,000 RWF
            } else {
                return 600; // 600 RWF fee for above 200,000 RWF
            }
        }
        
        // Update transfer summary with fees
        function updateTransferSummary() {
            const amount = parseFloat(transferAmount) || 0;
            const fee = calculateTransferFee(amount);
            const total = amount + fee;
            
            const feeDisplay = document.getElementById('transfer-fee-display');
            
            if (amount > 1000) {
                feeDisplay.style.display = 'block';
                document.getElementById('transfer-base-amount').textContent = amount.toLocaleString() + ' RWF';
                document.getElementById('transfer-fee-amount').textContent = fee.toLocaleString() + ' RWF';
                document.getElementById('transfer-total-amount').textContent = total.toLocaleString() + ' RWF';
            } else if (amount > 0) {
                feeDisplay.style.display = 'block';
                document.getElementById('transfer-base-amount').textContent = amount.toLocaleString() + ' RWF';
                document.getElementById('transfer-fee-amount').textContent = '0 RWF';
                document.getElementById('transfer-total-amount').textContent = amount.toLocaleString() + ' RWF';
            } else {
                feeDisplay.style.display = 'none';
            }
        }

        // Amount input functions
        function addToAmount(digit, type) {
            let currentAmount = '';
            
            if (type === 'deposit') {
                currentAmount = depositAmount;
            } else if (type === 'withdraw') {
                currentAmount = withdrawAmount;
            } else if (type === 'transfer') {
                currentAmount = transferAmount;
            }

            if (digit === '.' && currentAmount.includes('.')) {
                return;
            }
            
            currentAmount += digit;
            
            if (type === 'deposit') {
                depositAmount = currentAmount;
                document.getElementById('deposit-amount-display').textContent = currentAmount + ' RWF';
            } else if (type === 'withdraw') {
                withdrawAmount = currentAmount;
                document.getElementById('withdraw-amount-display').textContent = currentAmount + ' RWF';
                updateWithdrawalSummary();
            } else if (type === 'transfer') {
                transferAmount = currentAmount;
                document.getElementById('transfer-amount-display').textContent = currentAmount + ' RWF';
                updateTransferSummary();
            }
        }

        function deleteAmount(type) {
            if (type === 'deposit') {
                depositAmount = depositAmount.slice(0, -1);
                document.getElementById('deposit-amount-display').textContent = (depositAmount || '0') + ' RWF';
            } else if (type === 'withdraw') {
                withdrawAmount = withdrawAmount.slice(0, -1);
                document.getElementById('withdraw-amount-display').textContent = (withdrawAmount || '0') + ' RWF';
                updateWithdrawalSummary();
            } else if (type === 'transfer') {
                transferAmount = transferAmount.slice(0, -1);
                document.getElementById('transfer-amount-display').textContent = (transferAmount || '0') + ' RWF';
                updateTransferSummary();
            }
        }

        // Payment method selection
        function selectPaymentMethod(method, type) {
            // Clear all selections for this type
            const checkElements = document.querySelectorAll(`[id$="-check-${type}"]`);
            checkElements.forEach(el => el.textContent = '○');
            
            // Remove selected class from all payment methods
            const paymentMethods = document.querySelectorAll('.payment-method');
            paymentMethods.forEach(pm => pm.classList.remove('selected'));

            // Set the selected method
            if (type === 'deposit') {
                selectedDepositMethod = method;
                if (method === 'MTN Mobile Money') {
                    document.getElementById('mtn-check-deposit').textContent = '✓';
                } else if (method === 'Airtel Money') {
                    document.getElementById('airtel-check-deposit').textContent = '✓';
                } else if (method === 'Bank Transfer') {
                    document.getElementById('bank-check-deposit').textContent = '✓';
                }
            } else if (type === 'withdraw') {
                selectedWithdrawMethod = method;
                if (method === 'MTN Mobile Money') {
                    document.getElementById('mtn-check-withdraw').textContent = '✓';
                } else if (method === 'Airtel Money') {
                    document.getElementById('airtel-check-withdraw').textContent = '✓';
                } else if (method === 'Bank Transfer') {
                    document.getElementById('bank-check-withdraw').textContent = '✓';
                }
            } else if (type === 'transfer') {
                selectedTransferMethod = method;
                if (method === 'MTN Mobile Money') {
                    document.getElementById('mtn-check-transfer').textContent = '✓';
                } else if (method === 'Airtel Money') {
                    document.getElementById('airtel-check-transfer').textContent = '✓';
                } else if (method === 'Bank Transfer') {
                    document.getElementById('bank-check-transfer').textContent = '✓';
                }
            }

            // Add selected class to clicked method
            event.currentTarget.classList.add('selected');
        }

        // Update withdrawal summary
        function updateWithdrawalSummary() {
            const summaryDiv = document.getElementById('withdrawal-summary');
            if (withdrawAmount && parseFloat(withdrawAmount) > 0) {
                const baseAmount = parseFloat(withdrawAmount);
                const fee = baseAmount * 0.02; // 2% fee
                const netAmount = baseAmount - fee;

                document.getElementById('withdrawal-base-amount').textContent = baseAmount.toLocaleString() + ' RWF';
                document.getElementById('withdrawal-fee').textContent = fee.toLocaleString() + ' RWF';
                document.getElementById('withdrawal-net-amount').textContent = netAmount.toLocaleString() + ' RWF';
                
                summaryDiv.style.display = 'block';
            } else {
                summaryDiv.style.display = 'none';
            }
        }

        // Process transactions
        async function processDeposit() {
            if (!depositAmount || !selectedDepositMethod) {
                alert('Please enter an amount and select a payment method');
                return;
            }

            const amount = parseFloat(depositAmount);
            
            let apiEndpoint = '';
            let requestData = { amount };

            if (selectedDepositMethod === 'MTN Mobile Money') {
                apiEndpoint = '/payments/deposit/mtn';
                const phoneNumber = prompt('Enter your MTN Mobile Money number:');
                if (!phoneNumber) return;
                requestData.phoneNumber = phoneNumber;
                requestData.payerMessage = 'AGASEKE Deposit';
            } else if (selectedDepositMethod === 'Airtel Money') {
                alert('Airtel Money integration coming soon!');
                return;
            } else if (selectedDepositMethod === 'Bank Transfer') {
                apiEndpoint = '/payments/deposit/stripe';
                requestData.currency = 'USD'; // You can make this configurable
            }

            const result = await apiCall(apiEndpoint, {
                method: 'POST',
                body: JSON.stringify(requestData)
            });

            if (result && result.success) {
                if (selectedDepositMethod === 'Bank Transfer') {
                    // Handle Stripe payment intent
                    if (result.clientSecret) {
                        alert(`Payment initiated!\nAmount: ${amount.toLocaleString()} RWF\nTransaction ID: ${result.transactionId}\n\nPlease complete the payment using your bank card.`);
                        // In a real app, you'd integrate Stripe Elements here
                    }
                } else {
                    alert(`Payment request sent!\nAmount: ${amount.toLocaleString()} RWF\nTransaction ID: ${result.transactionId}\n\nPlease check your phone and authorize the payment.`);
                }
                
                // Reset form
                depositAmount = '';
                selectedDepositMethod = '';
                document.getElementById('deposit-amount-display').textContent = '0 RWF';
                document.querySelectorAll('[id$="-check-deposit"]').forEach(el => el.textContent = '○');
                document.querySelectorAll('.payment-method').forEach(pm => pm.classList.remove('selected'));
                
                showPage('home');
                loadUserData(); // Refresh data
            }
        }

        async function requestWithdrawal() {
            const reason = document.getElementById('withdrawal-reason').value;
            
            if (!withdrawAmount || !selectedWithdrawMethod || !reason) {
                alert('Please enter an amount, select a withdrawal method, and provide a reason');
                return;
            }

            const amount = parseFloat(withdrawAmount);
            const pin = prompt('Enter your 4-digit PIN to confirm withdrawal:');
            if (!pin || pin.length !== 4) {
                alert('Invalid PIN');
                return;
            }

            let apiEndpoint = '';
            let requestData = { amount, reason, pin };

            if (selectedWithdrawMethod === 'MTN Mobile Money') {
                apiEndpoint = '/payments/withdraw/mtn';
                const phoneNumber = prompt('Enter the MTN Mobile Money number to receive funds:');
                if (!phoneNumber) return;
                requestData.phoneNumber = phoneNumber;
            } else {
                alert('This withdrawal method is not yet supported');
                return;
            }

            const result = await apiCall(apiEndpoint, {
                method: 'POST',
                body: JSON.stringify(requestData)
            });

            if (result && result.success) {
                alert(`Withdrawal request submitted!\nAmount: ${amount.toLocaleString()} RWF\nFee: ${result.fee.toLocaleString()} RWF\nTotal Deduction: ${result.totalDeduction.toLocaleString()} RWF\n\nYour request has been sent to ${result.approver.name} (${result.approver.phone}) for approval.`);
                
                // Reset form
                withdrawAmount = '';
                selectedWithdrawMethod = '';
                document.getElementById('withdraw-amount-display').textContent = '0 RWF';
                document.getElementById('withdrawal-reason').value = '';
                document.getElementById('withdrawal-summary').style.display = 'none';
                document.querySelectorAll('[id$="-check-withdraw"]').forEach(el => el.textContent = '○');
                document.querySelectorAll('.payment-method').forEach(pm => pm.classList.remove('selected'));
                
                showPage('home');
                loadUserData(); // Refresh data
            }
        }

        async function processTransfer() {
            const recipientPhone = document.getElementById('recipient-phone').value;
            const recipientName = document.getElementById('recipient-name').value;
            
            if (!transferAmount || !selectedTransferMethod || !recipientPhone || !recipientName) {
                alert('Please fill in all fields and select a transfer method');
                return;
            }

            const amount = parseFloat(transferAmount);
            const transferFee = calculateTransferFee(amount);
            const totalDeduction = amount + transferFee;
            
            // Check if user has sufficient balance
            if (totalDeduction > totalBalance) {
                alert(`Insufficient balance. You need ${totalDeduction.toLocaleString()} RWF (including ${transferFee.toLocaleString()} RWF transfer fee), but you only have ${totalBalance.toLocaleString()} RWF.`);
                return;
            }
            
            const pin = prompt(`Confirm transfer:\n• Amount to send: ${amount.toLocaleString()} RWF\n• Transfer fee: ${transferFee.toLocaleString()} RWF\n• Total deduction: ${totalDeduction.toLocaleString()} RWF\n\nEnter your 4-digit PIN:`);
            if (!pin || pin.length !== 4) {
                alert('Invalid PIN');
                return;
            }

            const requestData = {
                amount,
                transferFee,
                recipientPhone,
                pin,
                message: `Transfer from ${currentUser.fullName}`
            };

            const result = await apiCall('/payments/transfer/internal', {
                method: 'POST',
                body: JSON.stringify(requestData)
            });

            if (result && result.success) {
                alert(`Transfer completed successfully!\n• Amount sent: ${amount.toLocaleString()} RWF\n• Transfer fee: ${transferFee.toLocaleString()} RWF\n• Total deducted: ${totalDeduction.toLocaleString()} RWF\n• Recipient: ${result.recipient.name} (${result.recipient.phone})\n• Your new balance: ${result.newBalance.toLocaleString()} RWF`);
                
                // Update balance and profit (you earn from transfer fees)
                totalBalance = result.newBalance;
                if (result.totalProfit !== undefined) {
                    totalProfit = result.totalProfit;
                }
                updateBalanceDisplay();
                
                // Reset form
                transferAmount = '';
                selectedTransferMethod = '';
                document.getElementById('transfer-amount-display').textContent = '0 RWF';
                document.getElementById('transfer-fee-display').style.display = 'none';
                document.getElementById('recipient-phone').value = '';
                document.getElementById('recipient-name').value = '';
                document.getElementById('name-status').textContent = 'Enter phone number to auto-fill name';
                document.getElementById('name-status').style.color = '#666';
                document.querySelectorAll('[id$="-check-transfer"]').forEach(el => el.textContent = '○');
                document.querySelectorAll('.payment-method').forEach(pm => pm.classList.remove('selected'));
                
                showPage('home');
                loadUserData(); // Refresh data
            }
        }

        // Approval functions
        function approveWithdrawal(requestId) {
            const request = pendingWithdrawals.find(r => r.id === requestId);
            if (!request) return;

            // Process the withdrawal
            totalBalance -= request.amount;
            totalProfit += request.fee;

            // Update transaction status
            const transaction = transactions.find(t => t.description.includes('Withdrawal request') && t.amount === request.amount);
            if (transaction) {
                transaction.status = 'completed';
                transaction.description = `Withdrawal to ${request.method}`;
            }

            // Remove from pending
            pendingWithdrawals = pendingWithdrawals.filter(r => r.id !== requestId);

            // Update UI
            document.getElementById('total-balance').textContent = totalBalance.toLocaleString() + ' RWF';
            document.getElementById('total-profit').textContent = totalProfit.toLocaleString() + ' RWF';

            alert(`Withdrawal approved!\nAmount: ${(request.amount - request.fee).toLocaleString()} RWF sent to ${request.method}`);
            
            updatePendingRequestsHome();
            loadActivityPage();
        }

        function rejectWithdrawal(requestId) {
            const request = pendingWithdrawals.find(r => r.id === requestId);
            if (!request) return;

            // Update transaction status
            const transaction = transactions.find(t => t.description.includes('Withdrawal request') && t.amount === request.amount);
            if (transaction) {
                transaction.status = 'rejected';
                transaction.description = `Withdrawal request rejected - ${request.reason}`;
            }

            // Remove from pending
            pendingWithdrawals = pendingWithdrawals.filter(r => r.id !== requestId);

            alert(`Withdrawal request rejected.\nReason: ${request.reason}`);
            
            updatePendingRequestsHome();
            loadActivityPage();
        }

        // Update pending requests on home page
        function updatePendingRequestsHome() {
            const pendingSection = document.getElementById('pending-requests-home');
            const pendingList = document.getElementById('pending-list-home');

            if (pendingWithdrawals.length > 0) {
                pendingSection.style.display = 'block';
                pendingList.innerHTML = '';

                pendingWithdrawals.forEach(request => {
                    const requestDiv = document.createElement('div');
                    requestDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600;">${request.amount.toLocaleString()} RWF</div>
                                <div style="font-size: 12px; color: #666;">${request.reason}</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="approve-btn" onclick="approveWithdrawal('${request.id}')">Approve</button>
                                <button class="reject-btn" onclick="rejectWithdrawal('${request.id}')">Reject</button>
                            </div>
                        </div>
                    `;
                    pendingList.appendChild(requestDiv);
                });
            } else {
                pendingSection.style.display = 'none';
            }
        }

        // Load activity page
        function loadActivityPage() {
            updateStatistics();
            loadPendingRequests();
            loadTransactions();
        }

        function updateStatistics() {
            const deposits = transactions.filter(t => t.type === 'deposit' && t.status === 'completed');
            const withdrawals = transactions.filter(t => t.type === 'withdraw' && t.status === 'completed');
            const transfers = transactions.filter(t => t.type === 'transfer' && t.status === 'completed');

            document.getElementById('total-deposits').textContent = deposits.length;
            document.getElementById('total-withdrawals').textContent = withdrawals.length;
            document.getElementById('total-transfers').textContent = transfers.length;
            document.getElementById('pending-count').textContent = pendingWithdrawals.length;
        }

        function loadPendingRequests() {
            const pendingSection = document.getElementById('pending-requests-section');
            const pendingList = document.getElementById('pending-requests-list');

            if (pendingWithdrawals.length > 0) {
                pendingSection.style.display = 'block';
                pendingList.innerHTML = '';

                pendingWithdrawals.forEach(request => {
                    const requestDiv = document.createElement('div');
                    requestDiv.className = 'request-item';
                    requestDiv.innerHTML = `
                        <div>
                            <div style="font-weight: 600;">${request.amount.toLocaleString()} RWF to ${request.method}</div>
                            <div style="font-size: 12px; color: #666;">Reason: ${request.reason}</div>
                            <div style="font-size: 12px; color: #666;">${request.date.toLocaleDateString()}</div>
                        </div>
                        <div class="request-actions">
                            <button class="approve-btn" onclick="approveWithdrawal('${request.id}')">Approve</button>
                            <button class="reject-btn" onclick="rejectWithdrawal('${request.id}')">Reject</button>
                        </div>
                    `;
                    pendingList.appendChild(requestDiv);
                });
            } else {
                pendingSection.style.display = 'none';
            }
        }

        // Filter transactions
        function filterTransactions(filter) {
            currentFilter = filter;
            
            // Update filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadTransactions();
        }

        // Load transactions
        function loadTransactions() {
            const transactionList = document.getElementById('transaction-list');
            transactionList.innerHTML = '';

            let filteredTransactions = transactions;
            
            if (currentFilter !== 'all') {
                if (currentFilter === 'pending') {
                    filteredTransactions = transactions.filter(t => t.status === 'pending');
                } else {
                    filteredTransactions = transactions.filter(t => t.type === currentFilter);
                }
            }

            if (filteredTransactions.length === 0) {
                transactionList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No transactions found</div>';
                return;
            }

            filteredTransactions.forEach(transaction => {
                const transactionDiv = document.createElement('div');
                transactionDiv.className = 'transaction-item';

                let iconClass = '';
                let amountClass = '';
                let amountText = '';
                let statusText = '';

                if (transaction.type === 'deposit') {
                    iconClass = 'deposit-transaction';
                    amountClass = 'positive';
                    amountText = `+${transaction.amount.toLocaleString()} RWF`;
                } else if (transaction.type === 'withdraw') {
                    if (transaction.status === 'pending') {
                        iconClass = 'pending-transaction';
                        amountClass = 'pending';
                        amountText = `${transaction.amount.toLocaleString()} RWF (Pending)`;
                    } else {
                        iconClass = 'withdraw-transaction';
                        amountClass = 'negative';
                        amountText = `-${transaction.amount.toLocaleString()} RWF`;
                    }
                } else if (transaction.type === 'transfer') {
                    iconClass = 'transfer-transaction';
                    amountClass = 'negative';
                    amountText = `-${transaction.amount.toLocaleString()} RWF`;
                }

                if (transaction.status === 'pending') {
                    statusText = ' (Pending Approval)';
                } else if (transaction.status === 'rejected') {
                    statusText = ' (Rejected)';
                    amountClass = 'negative';
                }

                transactionDiv.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-icon ${iconClass}">
                            ${transaction.type === 'deposit' ? '+' : transaction.type === 'withdraw' ? '-' : '→'}
                        </div>
                        <div class="transaction-details">
                            <h4>${transaction.description}${statusText}</h4>
                            <div class="transaction-date">${transaction.date.toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="transaction-amount ${amountClass}">${amountText}</div>
                `;

                transactionList.appendChild(transactionDiv);
            });
        }

        // Settings functions
        function toggleNotifications() {
            notificationsEnabled = !notificationsEnabled;
            document.getElementById('notification-toggle').textContent = notificationsEnabled ? 'ON' : 'OFF';
            alert(`Notifications ${notificationsEnabled ? 'enabled' : 'disabled'}`);
        }

        function contactSupport() {
            alert('Customer Support\n\nPhone: +250 786 739 043\nEmail: anthonyregina48@gmail.com\nHours: Mon-Fri, 8AM-6PM (EAT)\nEmergency: 24/7 for urgent issues\n\nHow can we help you today?');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                authToken = null;
                currentUser = null;
                localStorage.removeItem('authToken');
                alert('You have been logged out successfully.\n\nThank you for using AGASEKE!');
                showLoginPage();
            }
        }

        function createGoal() {
            const goalName = document.getElementById('goal-name').value;
            const goalAmount = document.getElementById('goal-amount').value;
            const goalDate = document.getElementById('goal-date').value;

            if (goalName && goalAmount && goalDate) {
                // Get existing goals from localStorage
                let goals = JSON.parse(localStorage.getItem('agaseke_goals') || '[]');
                
                // Create new goal
                const newGoal = {
                    id: Date.now(),
                    name: goalName,
                    targetAmount: parseFloat(goalAmount),
                    currentAmount: 0,
                    targetDate: goalDate,
                    createdDate: new Date().toISOString()
                };
                
                // Add to goals array
                goals.push(newGoal);
                
                // Save to localStorage
                localStorage.setItem('agaseke_goals', JSON.stringify(goals));
                
                alert(`Goal "${goalName}" created successfully!\nTarget: ${parseFloat(goalAmount).toLocaleString()} RWF by ${goalDate}`);
                
                // Clear form
                document.getElementById('goal-name').value = '';
                document.getElementById('goal-amount').value = '';
                document.getElementById('goal-date').value = '';
                
                // Show goals page
                showPage('goals');
                loadGoals();
            } else {
                alert('Please fill in all fields');
            }
        }

        function loadGoals() {
            const goalsList = document.getElementById('goals-list');
            const goals = JSON.parse(localStorage.getItem('agaseke_goals') || '[]');
            
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-goals">
                        <div class="empty-goals-icon">🎯</div>
                        <h3>No Goals Yet</h3>
                        <p>Create your first savings goal to get started!</p>
                    </div>
                `;
                return;
            }
            
            goalsList.innerHTML = goals.map(goal => {
                const progress = (goal.currentAmount / goal.targetAmount) * 100;
                const daysLeft = Math.ceil((new Date(goal.targetDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-name">${goal.name}</div>
                            <button onclick="deleteGoal(${goal.id})" style="background: none; border: none; color: #FF5722; cursor: pointer; font-size: 18px;">🗑️</button>
                        </div>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="goal-amount">
                            ${goal.currentAmount.toLocaleString()} RWF / ${goal.targetAmount.toLocaleString()} RWF
                        </div>
                        <div class="goal-info">
                            <span>${Math.round(progress)}% complete</span>
                            <span>${daysLeft > 0 ? daysLeft + ' days left' : 'Overdue'}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                let goals = JSON.parse(localStorage.getItem('agaseke_goals') || '[]');
                goals = goals.filter(g => g.id !== goalId);
                localStorage.setItem('agaseke_goals', JSON.stringify(goals));
                loadGoals();
            }
        }

        // Initialize
        async function initialize() {
            console.log('Initializing AGASEKE App...');
            
            // Add mobile touch support
            addMobileTouchSupport();
            
            // Test server connection first
            try {
                console.log('🔗 Testing server connection...');
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    console.log('✅ Server connection successful');
                } else {
                    console.warn('⚠️ Server responded with error:', response.status);
                }
            } catch (error) {
                console.error('❌ Cannot connect to server:', error.message);
                alert('⚠️ Cannot connect to backend server.\n\nPlease make sure:\n1. Backend server is running (npm start)\n2. Server is accessible at http://localhost:3000\n3. Check the browser console for more details');
                return;
            }
            
            updateTime();
            setInterval(updateTime, 1000);
            
            // Check authentication
            console.log('🔐 Checking authentication...');
            const isAuthenticated = await checkAuth();
            if (isAuthenticated) {
                console.log('✅ User authenticated, loading data...');
                loadUserData();
                updatePendingRequestsHome();
            } else {
                console.log('🔓 User not authenticated');
            }
            
            console.log('✅ App initialization complete');
        }

        // Add mobile touch support
        function addMobileTouchSupport() {
            // Add touch event delegation for all clickable elements
            document.addEventListener('touchend', function(e) {
                const element = e.target.closest('[onclick], button, .action-btn, .nav-item, .back-btn, .filter-tab');
                if (element && element.onclick) {
                    e.preventDefault();
                    element.click();
                }
            });
            
            // Ensure all buttons are properly focusable
            document.querySelectorAll('button, [onclick]').forEach(element => {
                if (!element.tabIndex) {
                    element.tabIndex = 0;
                }
            });
        }

        // Start the app when page loads
        window.addEventListener('load', initialize);
    </script>
</body>
</html>

